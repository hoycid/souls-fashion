<!DOCTYPE html>
<html lang="en">
  <head>
	<link rel="manifest" href="resources/site.webmanifest">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta name="description" content="Design perfect color-matching outfits in Elden Ring with souls.fashion. Explore coordinated armor sets, weapons, and accessories for a unique style that suits your Tarnished – the ultimate Elden Ring fashion tool!">
		<meta property="og:site_name" content="Elden Ring - Fashion Souls" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Spectral"
    />
    <link rel="stylesheet" href="resources/styles.css?v1.0.5" />
    <link rel="icon" type="image/x-icon" href="icon.ico" />
    <link
      rel="apple-touch-icon"
      type="image/png"
      sizes="180x180"
      href="favicons/icon_180x180.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="favicons/icon_16x16.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="favicons/icon_32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="48x48"
      href="favicons/icon_48x48.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="96x96"
      href="favicons/icon_96x96.png"
    />
    <title>Elden Ring - Fashion Souls v.0.6</title>
  </head>
  <body>
    <nav class="navigation">
      <div class="topnav">
        <a class="FashionSouls-nav" href="index">
          <h2>Fashion Souls</h2>
          <h3 style="color: #bfbfbf">SoulsBorne fashion tool by Psyopgirl</h3>
        </a>
        <div class="search-bar">
          <div class="color-picker-group">
            <input
              class="color-picker"
              type="color"
              id="favcolor"
              name="favcolor"
              value="#ff0000"
            />
          </div>
          <input
            class="search-input"
            type="text"
            id="searchInput"
            placeholder="Search by item"
          />
          <div class="search-bar-buttons">
            <button class="toggle-search-button" id="toggleSearch">Item</button>
          </div>
        </div>
        <div class="links-group">
          <a href="index">Home</a>
          <div class="dropdown">
            <!-- <button class="dropbtn">Games -->
            </button>
            <div class="dropdown-content">
                <a href="ds1">Dark Souls Remastered</a>
                <a href="ds2">Dark Souls II: SotFS</a>
                <a href="ds3">Dark Souls III</a>
            </div>
          </div>
          <a href="https://discord.gg/j8HHh8ffEn">Discord</a>
          <a href="https://github.com/jadepilled/souls-fashion">Github</a>
          <a href="https://ko-fi.com/psyopgirl">Donate</a>
          <a href="feedback.html">Feedback</a>
          <button class="mode-switch" id="modeToggle">Light Mode</button>
        </div>
        <button class="show-menu">
          <img class="menu-icon" src="resources/icons/menu.svg" />
        </button>
      </div>
      <div class="filters-group">
        <button id="headFilter">Head</button>
        <button id="chestFilter">Chest</button>
        <button id="handsFilter">Hands</button>
        <button id="legsFilter">Legs</button>
        <button id="weaponsFilter">Weapons</button>
        <button id="shieldsFilter">Shields</button>
        <button id="clearFilter">Clear Filters</button>
        <div class="sliders">
          <div class="slider-container">
            <label for="secondaryWeightSlider">
              <div class="tooltip">
                Weight for Secondary Colors:
                <span class="tooltip-text">
                  Determines to what extent secondary colors are included in
                  your color match results. Higher weight = more consideration
                  given to secondary colors.</span
                >
              </div>
            </label>
            <input
              type="range"
              id="secondaryWeightSlider"
              name="secondaryWeight"
              min="0"
              max="1"
              step="0.1"
              value="0.5"
            />
            <p id="sliderValue">0.5</p>
          </div>
          <div class="slider-container">
            <label for="colorThresholdSlider">
              <div class="tooltip">
                Color Similarity Threshold:
                <span class="tooltip-text">
                  Allows you to specify how similar search results should be to
                  your chosen color. Setting the threshold higher will include
                  items that are less similar in color to your chosen color, and
                  vice versa.
                </span>
              </div>
            </label>
            <input
              type="range"
              id="colorThresholdSlider"
              name="colorThreshold"
              min="0"
              max="500"
              step="10"
              value="100"
            />
            <p id="colorThresholdValue">100</p>
          </div>
        </div>
      </div>
    </nav>

    <div class="FashionSouls">
      <h2 >Fashion Souls</h2>
      <h3 style="color: #bfbfbf">SoulsBorne fashion tool by Psyopgirl</h3>
    </div>


    <div id="contextMenu" class="custom-context-menu">
      <ul id="contextMenuList">
          <li id="removeItemOption">Remove Item</li>
      </ul>
    </div>

    <div class="hover-trigger">
      <div class="pinned">
        <!-- <div class="tooltip">
          <span class="tooltip-text">
            To commit an item to the outfit simulator, right click an item card and select 'send to outfit simulator'.
          </span>
        </div> -->
          <div class="pinned-buttons">
            <!-- <a href="simulator_eldenring.html" class="link">
              View Presets
            </a> -->
            <button id="export" onclick="window.location.href='simulator_eldenring.html'">Export</button>
          </div>
        <div class="slots" id="outfitSlots">
          <div class="slot">
            <p>Head</p>
            <img href="" />
          </div>
          <div class="slot">
            <p>Body</p>
            <img href="" />
          </div>
          <div class="slot">
            <p>Hands</p>
            <img href="" />
          </div>
          <div class="slot">
            <p>Legs</p>
            <img href="" />
          </div>
          <div class="slot">
            <p>Weapon</p>
            <img href="" />
          </div>
          <div class="slot">
            <p>Shield</p>
            <img href="" />
          </div>
        </div>
      </div>
    </div>
    <main class="item-grid" id="itemGrid">
      <p>Loading...</p>
      <!-- Items will be dynamically loaded here -->
    </main>

    <footer class="footer">
      Copyright © Psyopgirl 2024.<br />
      Dark Souls, Elden Ring, Bloodborne & Demon's Souls are property of Sony &
      FromSoftware respectively.

      <button class="back-to-top-button">Back to Top</button>
    </footer>

    <script src="search_items_eldenring.js?v1.0.5"></script>
    <script>
      const modeToggle = document.getElementById("modeToggle");
      const body = document.body;
      const toggleSearch = document.getElementById("toggleSearch");
      const colorPicker = document.getElementById("favcolor");
      const searchInput = document.getElementById("searchInput");

      // Check local storage to persist theme choice
      if (localStorage.getItem("theme") === "light") {
          body.classList.add("light-mode");
          modeToggle.textContent = "Dark Mode"; 
      } else {
        modeToggle.textContent = "Light Mode";
      }

      modeToggle.addEventListener("click", () => {
        if (body.classList.contains("light-mode")) {
            body.classList.remove("light-mode");
            localStorage.setItem("theme", "dark");
            modeToggle.textContent = "Light Mode"; 
        } else {
            body.classList.add("light-mode");
            localStorage.setItem("theme", "light");
            modeToggle.textContent = "Dark Mode";
        }
      });

      toggleSearch.addEventListener("click", () => {
        const isColorPickerVisible = colorPicker.style.display !== "none";
        colorPicker.style.display = isColorPickerVisible
          ? "none"
          : "inline-block";
        toggleSearch.textContent = isColorPickerVisible ? "Item" : "Hex";
        searchInput.placeholder = isColorPickerVisible
          ? "Search by item"
          : "Search by hex";
        searchInput.disabled = !isColorPickerVisible;
        searchInput.value = "";
        colorPicker.value = "";
      });

      // Initially hide the color picker if needed
      colorPicker.style.display = "none";

      // Update searchInput value whenever favcolor changes
      colorPicker.addEventListener("input", () => {
        searchInput.placeholder = colorPicker.value;
      });

      const toggleButton = document.querySelector('.show-menu');
      const sidebar = document.querySelector('.links-group');
      const itemGrid = document.querySelector('.item-grid');
      const topNav = document.querySelector('.topNav');
      const fashionSouls= document.querySelector('.FashionSouls');

      toggleButton.addEventListener('click', () => {
        sidebar.classList.toggle('show');
      });

      document.getElementById("export").addEventListener("click", () => {
        window.location.href = "simulator_eldenring.html";
      });

      // const triggerElement = document.querySelector('.hover-trigger'); // Replace with your actual trigger element
      // const pinned = document.querySelector('.pinned');

      // // Show pinned and adjust margin on hover
      // triggerElement.addEventListener('mouseover', () => {
      //   pinned.style.opacity = "1";
      //   pinned.style.display = "block";
      //   itemGrid.style.marginTop = "20px";
      //   itemGrid.style.marginLeft = "70px"; // Change to desired value
      //   nav.classList.add('hidden-on-scroll');
      // });

      // // Hide the pinned element and reset margin when not hovering
      // triggerElement.addEventListener('mouseout', () => {
      //   pinned.style.opacity = "0";
      //   pinned.style.display = "none";
      //   itemGrid.style.marginTop = "180px";
      //   itemGrid.style.marginLeft = "0px"; 
      //   nav.classList.remove('hidden-on-scroll');
      // });

      let sidebarActive = false;
      let navActive = true;
      let lastTouchY = 0; // Variable to track the last Y position on touch devices

      function showOutfitSidebar() {
        document.querySelector(".pinned").style.opacity = "1";
        document.querySelector(".pinned").style.display = "block";
        
        if (window.innerWidth <= 768) { // Mobile screen
          document.querySelector(".item-grid").style.marginTop = "0";
        } else {
          document.querySelector(".item-grid").style.marginTop = "20px";
        }
        
        document.querySelector(".item-grid").style.marginLeft = "70px";
        sidebarActive = true;
        navActive = false;
      }

      function hideOutfitSidebar() {
        document.querySelector(".pinned").style.opacity = "0";
        document.querySelector(".pinned").style.display = "none";

        if (window.innerWidth <= 768) { // Mobile screen
          document.querySelector(".item-grid").style.marginTop = "0";
        } else {
          document.querySelector(".item-grid").style.marginTop = "180px";
        }

        document.querySelector(".item-grid").style.marginLeft = "0";
        sidebarActive = false;
        navActive = true;
      }

      function showNav() {
        if (sidebarActive === false) {
          nav.classList.remove('hidden-on-scroll');

          if (window.innerWidth <= 768) { // Mobile screen
          document.querySelector(".item-grid").style.marginTop = "0";
          } else {
            document.querySelector(".item-grid").style.marginTop = "180px";
          }

          document.querySelector(".item-grid").style.marginLeft = "0px";
          sidebarActive = false;
          navActive = true;
        }
      }

      function hideNav() {
        if (sidebarActive === true) {
          nav.classList.add('hidden-on-scroll');

          if (window.innerWidth <= 768) { // Mobile screen
          document.querySelector(".item-grid").style.marginTop = "0";
          } else {
            document.querySelector(".item-grid").style.marginTop = "20px";
          }

          document.querySelector(".item-grid").style.marginLeft = "70px";
          sidebarActive = true;
          navActive = false;
        }
      }

      // Activate effect on scroll attempt (downward or upward for wheel)
      window.addEventListener("wheel", (event) => {
        if (event.deltaY > 0 && !sidebarActive) {
          showOutfitSidebar(); // Scrolling down
          hideNav();
        } else if (event.deltaY < 0 && sidebarActive) {
          hideOutfitSidebar(); // Scrolling up
          showNav();
        }
      });

      // Activate effect on touch devices
      window.addEventListener("touchstart", (event) => {
        lastTouchY = event.touches[0].clientY; // Track initial touch position
      });

      window.addEventListener("touchmove", (event) => {
        const currentTouchY = event.touches[0].clientY;
        if (currentTouchY < lastTouchY && !sidebarActive) {
          showOutfitSidebar(); // Scrolling down
        } else if (currentTouchY > lastTouchY && sidebarActive) {
          hideOutfitSidebar(); // Scrolling up
        }
        lastTouchY = currentTouchY; // Update last touch position
      });

      window.addEventListener("scroll", () => {
        if (window.scrollY > 400) {
          // Adjust this value based on when you want it to appear
          document.querySelector(".back-to-top-button").style.opacity = "1";
          document.querySelector(".back-to-top-button").style.display = "block";
          document.querySelector(".footer").style.opacity = "1";
        } else {
          document.querySelector(".back-to-top-button").style.opacity = "0";
          document.querySelector(".back-to-top-button").style.display = "none";
          document.querySelector(".footer").style.opacity = "0";
        }
      });

      // JavaScript to toggle the class on scroll
      let lastScrollTop = 0;
      const nav = document.querySelector('.navigation');

      window.addEventListener('scroll', () => {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        if (scrollTop > lastScrollTop && !navActive) {
          // User is scrolling down
          hideNav();
        }
        else {
          // User is scrolling up
          showNav();
        }
        lastScrollTop = scrollTop <= 0 ? 0 : scrollTop; // Ensure scrollTop doesn't go negative
      });

      document
        .querySelector(".back-to-top-button")
        .addEventListener("click", () => {
          window.scrollTo({ top: 0, behavior: "smooth" });
          showNav();
          hideOutfitSidebar();
        });

      // Add click event listener to all anchor links for fade effect
      document.querySelectorAll("a").forEach(link => {
        link.addEventListener("click", function (e) {
          e.preventDefault(); // Prevent default link behavior
          document.body.classList.add("fade-out"); // Add fade-out class

          // Delay the navigation to the new page to allow the fade-out effect to play
          setTimeout(() => {
            window.location.href = this.href; // Navigate to the new page
          }, 500); // Match this duration with the CSS transition duration
        });
      });

      // Listen for visibility change to manage the fade-in effect
      document.addEventListener("visibilitychange", () => {
        document.body.classList.toggle(
          "fade-out",
          document.visibilityState !== "visible"
        );
      });
    </script>
    <script>
      // Variables to track the right-clicked slot ID or item
      let rightClickedSlotId = null;
      let rightClickedItem = null;
  
      // Load outfit slots from localStorage
      function loadOutfitFromStorage() {
          const types = ["head", "chest", "hands", "legs", "weapons", "shields"];
          const outfitSlots = JSON.parse(localStorage.getItem('outfitSlots')) || {};
  
          const outfitContainer = document.getElementById("outfitSlots");
          outfitContainer.innerHTML = ''; // Clear existing items
  
          types.forEach(type => {
              const slotId = `${type}Slot`;
              const item = outfitSlots[slotId];
  
              const slot = document.createElement("div");
              slot.classList.add("slot");
              slot.dataset.slotId = slotId;
  
              if (item) {
            // Ensure the image path is normalized to use forward slashes
            const img = document.createElement("img");
            img.src = `pages/eldenring/icons/${type.charAt(0).toUpperCase() + type.slice(1)}/${item.image.replace(/_/g, ' ').replace(/\\/g, '/')}`;
            img.alt = item.name;

            const name = document.createElement("p");
            name.textContent = item.name;

            slot.appendChild(img);
            slot.appendChild(name);
              } else {
                  // Display placeholder
                  const placeholder = document.createElement("p");
                  placeholder.classList.add("placeholder-tile");
                  placeholder.textContent = `No ${type} selected`;
                  slot.appendChild(placeholder);
              }
  
              // Add right-click (contextmenu) event listener to show the remove item context menu
              slot.addEventListener('contextmenu', (event) => {
                  event.preventDefault();
                  showContextMenu(event, 'remove', slotId);
              });
  
              outfitContainer.appendChild(slot);
          });
  
          // Close the context menu when clicking outside
          document.addEventListener('click', (event) => {
              const contextMenu = document.getElementById('contextMenu');
              if (contextMenu.style.display === 'flex') {
                  contextMenu.style.display = 'none';
              }
          });
      }
  
      // Function to show the custom context menu for either removing or sending items
      function showContextMenu(event, action, identifier) {
          const contextMenu = document.getElementById('contextMenu');
          const contextMenuList = document.getElementById('contextMenuList');
          contextMenuList.innerHTML = ''; // Clear previous menu items
  
          const menuOption = document.createElement('li');
          if (action === 'remove') {
              rightClickedSlotId = identifier; // Store the slotId for later use
              menuOption.textContent = 'Remove Item';
              menuOption.addEventListener('click', removeItemFromOutfit);
          } else if (action === 'send') {
              rightClickedItem = identifier; // Store the item for later use
              menuOption.textContent = 'Send to Outfit Simulator';
              menuOption.addEventListener('click', sendItemToOutfitSimulator);
          }
  
          contextMenuList.appendChild(menuOption);
          contextMenu.style.top = `${event.pageY}px`;
          contextMenu.style.left = `${event.pageX}px`;
          contextMenu.style.display = 'flex';
      }
  
      // Function to remove an item from the current outfit
      function removeItemFromOutfit() {
          if (rightClickedSlotId) {
              // Fetch the current outfit from localStorage
              const outfit = JSON.parse(localStorage.getItem('outfitSlots')) || {};
  
              // Remove the item from the current outfit
              delete outfit[rightClickedSlotId];
  
              // Update the outfit in localStorage
              localStorage.setItem('outfitSlots', JSON.stringify(outfit));
  
              // Reload the outfitSlots to reflect the removal
              loadOutfitFromStorage();
          }
  
          // Hide the context menu after removing the item
          document.getElementById('contextMenu').style.display = 'none';
      }
  
      // Function to send an item to the outfit simulator
      function sendItemToOutfitSimulator() {
          if (rightClickedItem) {
              addItemToSimulator(rightClickedItem);
          }
  
          // Hide the context menu after sending the item
          document.getElementById('contextMenu').style.display = 'none';

          const pinned = document.querySelector('.pinned');

          // Show the elements and apply the styles
          showOutfitSidebar();
          hideNav();
      }
  
      // Add event listeners to item cards in itemGrid for sending items to the outfit simulator
      function initializeItemGrid() {
          const itemGrid = document.getElementById('itemGrid');
  
          itemGrid.querySelectorAll('.item-card').forEach(card => {
              card.addEventListener('contextmenu', (event) => {
                  event.preventDefault();
  
                  // Find the item in the `items` array
                  const itemInfo = card.querySelector('.item-info');
                  const titleContainer  = itemInfo.querySelector('.title-container');
                  const title = titleContainer.querySelector('a').textContent;
                  const item = items.find(i => i.name === title);
                  if (item) {
                      showContextMenu(event, 'send', item);
                  }
              });
          });
      }
  
  </script>
  
  <script>
// Set up the outfitSlots container as a drop target
function initializeDragAndDrop() {
    const itemGrid = document.getElementById('itemGrid');
    const outfitSlotsContainer = document.getElementById('outfitSlots');

    // Make each item card draggable
    itemGrid.querySelectorAll('.item-card').forEach(card => {
        card.setAttribute('draggable', 'true');

        // Store item name without file extension when dragging starts
        card.addEventListener('dragstart', (event) => {
            const itemInfo = card.querySelector('.item-info .title-container a').textContent;
            event.dataTransfer.setData('text/plain', itemInfo);  // Set item name as drag data
            console.log("Dragging item:", itemInfo);  // Debug: Check dragstart event
        });
    });

    // Enable outfitSlots as the drop target
    outfitSlotsContainer.addEventListener('dragover', (event) => {
        event.preventDefault();  // Allow item to be dropped
    });

    outfitSlotsContainer.addEventListener('drop', (event) => {
        event.preventDefault();
        const itemName = event.dataTransfer.getData('text/plain');  // Get item name
        
        // Verify that itemName data was successfully retrieved
        if (!itemName) {
            console.error("Drop event: No item name received");
            return;
        }
        console.log("Dropped item:", itemName);  // Debug: Check drop event
        
        // Find item type from the JSON data
        fetch('pages/eldenring/typed_items_for_web.json')
            .then(response => response.json())
            .then(jsonData => {
                const item = jsonData.find(i => i.name === itemName);
                
                if (!item) {
                    console.error("Item not found in JSON data:", itemName);
                    return;
                }
                
                const itemType = item.type;  // E.g., "head", "chest", etc.
                const slotType = `${itemType}Slot`;
                console.log("Item type:", itemType, "| Slot type:", slotType);  // Debug: Check item type and slot type
                
                // Update the specified slot with the dropped item
                addItemToSlot(slotType, itemName);
            })
            .catch(error => console.error("Error loading JSON data:", error));
    });
}

// Add item to the specified slot and update localStorage
function addItemToSlot(slotType, itemName) {
    // Get current outfit from local storage
    const outfitSlots = JSON.parse(localStorage.getItem('outfitSlots')) || {};

    // Update the slot in outfitSlots with the new item name (image name can be derived or set as needed)
    outfitSlots[slotType] = { name: itemName, image: `${itemName}.webp` };
    console.log("Updated outfitSlots:", outfitSlots);  // Debug: Check updated outfitSlots object

    // Save updated outfit to local storage
    localStorage.setItem('outfitSlots', JSON.stringify(outfitSlots));

    // Refresh the displayed outfit
    loadOutfitFromStorage();
}

// Initialize drag-and-drop functionality when items are loaded
window.onload = function() {
    fetchItems().then(() => {
        loadOutfitFromStorage();
        initializeItemGrid();
        initializeDragAndDrop();  // Enable drag-and-drop on items
    });

};


  </script>
  
  </body>
</html>
